<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>go_web_scaffold</title>
    <link type="text/css" rel="stylesheet" href="../css/bootstrap/bootstrap.min.css"/>
    <link type="text/css" rel="stylesheet" href="../css/bootstrap/bootstrap-vue.min.css"/>
</head>
<body>
<div class="container">
    <div id="go_web_scaffold">

    </div>
</div>
</body>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es2015%2CIntersectionObserver" crossorigin="anonymous"></script>
<script src="../js/common/vue.min.js"></script>
<script src="../js/common/qs.min.js"></script>
<script src="../js/common/axios.min.js"></script>
<script src="../js/bootstrap/bootstrap-vue.min.js"></script>
<script src="../js/bootstrap/bootstrap-vue-icons.min.js"></script>

<script src="../js/util.js"></script>
<script src="../js/api.js"></script>

<script>

    let vue = new Vue({
        el: '#go_web_scaffold',
        data: {
            sites: [],
            siteOptions: [
                { },
            ],
            word: '',
            jobFields: [
                {key: 'id', label: '任务编号', sortable: true},
                {key: 'site', label: '爬取网站', sortable: true},
                {key: 'word', label: '爬取关键词', sortable: true},
                {key: 'status', label: '任务状态', sortable: true},
                {key: 'fail_reason', label: '失败原因', sortable: true},
                {key: 'created_at', label: '创建时间', sortable: true},
                {key: 'start_time', label: '爬取开始时间', sortable: true},
                {key: 'end_time', label: '爬取完成时间', sortable: true},
            ],
            jobs: [],
        },
        methods: {
            async AddJob() {
                let promise = AddJob(this.sites, this.word)
                let data = await promise
                if (data !== null) {
                    alert('添加成功')
                }
            },
            async ListJob() {
                let promise = ListJob()
                let data = await promise
                if (data == null) {
                    data = []
                }
                if (data.jobs == null) {
                    data.jobs = []
                }
                for (let i = 0; i < data.jobs.length; i++) {
                    data.jobs[i].created_at = new Date(data.jobs[i].created_at).getTime()
                    data.jobs[i].start_time = new Date(data.jobs[i].start_time).getTime()
                    data.jobs[i].end_time = new Date(data.jobs[i].end_time).getTime()

                    if (data.jobs[i].created_at > 0) {
                        data.jobs[i].created_at = formatTimestamp(data.jobs[i].created_at, 'YYYY-MM-DD HH:mm:ss')
                    } else {
                        data.jobs[i].created_at = '-'
                    }
                    if (data.jobs[i].start_time > 0) {
                        data.jobs[i].start_time = formatTimestamp(data.jobs[i].start_time, 'YYYY-MM-DD HH:mm:ss')
                    } else {
                        data.jobs[i].start_time = '-'
                    }
                    if (data.jobs[i].end_time > 0) {
                        data.jobs[i].end_time = formatTimestamp(data.jobs[i].end_time, 'YYYY-MM-DD HH:mm:ss')
                    } else {
                        data.jobs[i].end_time = '-'
                    }
                }
                this.jobs = data.jobs
            },
        },
    })

    setInterval("crawler_vue.ListJob()", "1000")
</script>
</html>